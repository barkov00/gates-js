<!doctype html>
<html>
	<head>
		<title></title>
        <meta charset='utf-8' />
	</head>
	<body>
	<ul>
	
	Где какие тайлы:</br>
	<li>
	Белый (код 0) - пустота
	</li>
	<li>
	Серый (код 1) - начальная позиция робота
	</li>
	<li>
	Зеленый (код 2) - выход
	</li>
	<li>
	Коричневый (код 3) - стена
	</li>
	
	</ul>
	
	
	
	<!-- images -->
	
	<table width="300" border="1" cellpadding="5" style="text-align: center" align="center">
	<tr>
	<th width="75">
	<canvas height='480' width='480' id='world'>Обновите браузер</canvas>
	</th>
	<th>
	<canvas height='720' width='800' id='editor'>Обновите браузер</canvas>
	<script type="text/javascript" src="utils.js"></script>
	<script type="text/javascript" src="world.js"></script>
	<script type="text/javascript" src="editor.js"></script>
	<script type="text/javascript">
		//WTF??
		var vendors = ['webkit', 'moz'];
		for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
			window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];
			window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] || window[vendors[x] + 'CancelRequestAnimationFrame'];
		}
	
		var editor_canvas = document.getElementById("editor");
		var world_canvas = document.getElementById("world");
		var w_cx = null, e_cx = null;
		var currentTime = 0, lastTime = (new Date()).getTime();
		var sensorsLast = [0, 0, 0, 0];
		var pause = true;
		
		init_world(world_canvas.width, world_canvas.height);
		init_editor(editor_canvas);

		function mainLoop(){
			currentTime = (new Date()).getTime();
			var delta = (currentTime - lastTime) / 1000;
			lastTime = currentTime;
			
			
			world_update(delta); 
			world_draw(w_cx);
			
			var sensorsNew = world_readSensors();
			
			for(var i = 0; i < 4; i++){
				if(sensorsLast[i] != sensorsNew[i]) 
				{
					editor_setSensors(sensorsNew);
					solve();
					world_setEngines(editor_getEngines());
					sensorsLast[0] = sensorsNew[0];
					sensorsLast[1] = sensorsNew[1];
					sensorsLast[2] = sensorsNew[2];
					sensorsLast[3] = sensorsNew[3];
					break;
				}
			}
			
		
			editor_update(delta); 
			
			editor_draw(e_cx);
			
		
			requestAnimationFrame(mainLoop);
		}
		
		if ( (typeof (world_canvas.getContext) !== undefined) && (typeof (editor_canvas.getContext) !== undefined)) {
				w_cx = world_canvas.getContext('2d');
				e_cx = editor_canvas.getContext('2d');
				mainLoop();
		}
		
		function startSim(){
			sensorsLast[0] = 0;
			sensorsLast[1] = 0
			sensorsLast[2] = 0;
			sensorsLast[3] = 0;
			world_setEngines([0, 0, 0, 0]);
			editor_reset();
			init_world(world_canvas.width, world_canvas.height);
		}
	</script>
	
	
	<div style="display:none;">
	<!--<img id="nand" src="images/nand.png" onload="graphics_loaded()">-->
	<!--<img id="and" src="images/and.png" onload="graphics_loaded()">-->
	<!--<img id="not" src="images/not.png" onload="graphics_loaded()">-->
	<!--<img id="nor" src="images/nor.png" onload="graphics_loaded()">-->
	<!--<img id="xor" src="images/xor.png" onload="graphics_loaded()">-->
	<!--<img id="or" src="images/or.png" onload="graphics_loaded()">-->
	</div>
	
	<input type="button" onclick="startSim();" value="solve"/>
	
	</th>
	</tr>
	</table>

	</body>
</html>